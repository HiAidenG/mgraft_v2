name: rm_systems
description: Restriction-modification systems from DefenseFinder + REBASE
version: "1.0"

columns:
  genome_id:
    type: string
    required: true

  feature_type:
    type: string
    required: true
    enum: [RM_system]

  ID:
    type: string
    required: true
    pattern: "^{genome_id}__RMS\\d{4}$"

  contig:
    type: string
    required: true

  start:
    type: integer
    required: true
    min: 1

  end:
    type: integer
    required: true
    min: 1

  strand:
    type: string
    required: true
    enum: ["+", "-", "."]

  rm_type:
    type: string
    required: true
    enum: ["Type I", "Type II", "Type IIG", "Type III", "Type IV"]

  sys_wholeness:
    type: float
    required: true
    min: 0
    max: 1
    description: Fraction of expected genes present (1.0 = complete)

  n_genes:
    type: integer
    required: true
    min: 1

  tool_id:
    type: string
    required: true
    description: |
      DefenseFinder system identifier used for provenance tracking.
      Format: {genome_id}_{system_type}_{number}
      Example: 'GCA_046966225_RM_Type_I_11'
      Used for:
        - Linking child genes to parent systems (via genes' tool_id_parent)
        - Joining with DefenseFinder raw outputs (systems.tsv, hmmer.tsv)
        - Provenance tracking back to original DefenseFinder annotation
      Source: sys_id field from DefenseFinder systems output

derived_columns:
  recseq:
    added_by: 03_rm_annotation
    description: Recognition sequence from REBASE

  recseq_note:
    added_by: 03_rm_annotation
    enum: [annotated, missing_annotation, conflicting, no_recognition_site]

  mge_id:
    added_by: 08_mge_overlap
    description: ID of overlapping MGE (NULL if on chromosome)

  mobility_score:
    added_by: 08_mge_overlap
    type: float
    min: 0
    max: 1
    description: Highest fraction of system genes on any single MGE
